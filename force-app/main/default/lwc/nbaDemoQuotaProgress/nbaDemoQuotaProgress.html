<template>
    <div class="card">
        <div class="card-header collapsible-header" onclick={toggleSection}>
            <div class="card-header-left">
                <span class="card-title">QUOTA PROGRESS</span>
                <span class="period">This Month</span>
            </div>
            <lightning-icon icon-name={chevronIcon} size="x-small"></lightning-icon>
        </div>
        <template if:true={sectionExpanded}>
        <div class="quota-content">
            <div class="donut-container">
                <svg viewBox="0 0 120 120" class="donut-svg">
                    <!-- Background circle -->
                    <circle cx="60" cy="60" r="50" fill="none" stroke="#e2e8f0" stroke-width="10"></circle>
                    <!-- Blue arc: combined (closedWon + thisOpp) as bottom layer -->
                    <template if:true={hasThisOpp}>
                        <circle cx="60" cy="60" r="50" fill="none" stroke="#2563eb" stroke-width="10"
                            stroke-dasharray={combinedDashArray}
                            stroke-dashoffset={dashOffset}
                            stroke-linecap="round"
                            class="progress-ring"></circle>
                    </template>
                    <!-- Green arc: closedWon only, layered on top -->
                    <template if:true={hasClosedWon}>
                        <circle cx="60" cy="60" r="50" fill="none" stroke="#10B981" stroke-width="10"
                            stroke-dasharray={closedWonDashArray}
                            stroke-dashoffset={dashOffset}
                            stroke-linecap="round"
                            class="progress-ring"></circle>
                    </template>
                </svg>
                <div class="donut-center">
                    <span class="donut-percent">{percentageDisplay}%</span>
                </div>
            </div>
            <div class="quota-details">
                <div class="quota-amount">
                    <span class="amount-main">{formattedClosedWon}</span>
                    <span class="amount-sep"> / </span>
                    <span class="amount-target">{formattedTarget}</span>
                </div>
                <div class="quota-breakdown">
                    <div class="breakdown-item">
                        <span class="dot dot-green"></span>
                        <span class="breakdown-label">CLOSED WON</span>
                        <span class="breakdown-value">{formattedClosedWon}</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="dot dot-blue"></span>
                        <span class="breakdown-label">THIS OPP</span>
                        <span class="breakdown-value">{formattedThisOpp}</span>
                    </div>
                </div>
            </div>
        </div>
        <template if:true={isZeroProgress}>
            <p class="empty-state-text">No closed deals this month yet</p>
        </template>
        </template>
    </div>
</template>

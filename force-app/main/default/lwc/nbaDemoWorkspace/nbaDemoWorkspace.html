<template>
    <!-- Loading State -->
    <template lwc:if={isLoading}>
        <div class="loading-container">
            <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
        </div>
    </template>

    <!-- Empty State (App Page, no actions) -->
    <template lwc:if={showEmptyState}>
        <c-nba-empty-state></c-nba-empty-state>
    </template>

    <!-- Workspace Content -->
    <template lwc:if={showWorkspace}>
        <!-- Transition Overlay (during action complete/snooze/dismiss) -->
        <template lwc:if={isTransitioning}>
            <div class="transition-overlay">
                <lightning-spinner alternative-text="Loading next action" size="medium"></lightning-spinner>
            </div>
        </template>

        <!-- Alert Banner -->
        <c-nba-demo-alert-banner
            upcoming-event={upcomingEvent}
            current-action={currentAction}
            is-action-mode={isActionMode}>
        </c-nba-demo-alert-banner>

        <!-- Header -->
        <c-nba-demo-header
            header-data={headerData}
            contacts={contactsData}
            current-action={currentAction}
            is-action-mode={isActionMode}
            onemailnow={handleEmailNow}
            oncontactemail={handleContactEmail}
            onsmsnow={handleSmsNow}
            oncontactsms={handleContactSms}
            onsnooze={handleSnooze}>
        </c-nba-demo-header>

        <!-- Insights Panel -->
        <c-nba-demo-insights-panel
            insights-data={insightsData}
            current-action={currentAction}
            is-action-mode={isActionMode}>
        </c-nba-demo-insights-panel>

        <!-- Two Column Layout: Tabs + Sidebar -->
        <div class={workspaceBodyClass}>
            <!-- Left Column: Tabs -->
            <div class="workspace-main">
                <!-- Tab Bar -->
                <div class="tab-bar">
                    <button class={overviewTabClass} data-tab="overview" onclick={handleTabClick}>
                        <lightning-icon icon-name="utility:layout" size="x-small"></lightning-icon>
                        Overview
                    </button>
                    <button class={updatesTabClass} data-tab="updates" onclick={handleTabClick}>
                        <lightning-icon icon-name="utility:refresh" size="x-small"></lightning-icon>
                        Updates
                    </button>
                    <button class={payrollTabClass} data-tab="payroll" onclick={handleTabClick}>
                        <lightning-icon icon-name="utility:money" size="x-small"></lightning-icon>
                        Payroll
                    </button>
                    <button class={productsTabClass} data-tab="products" onclick={handleTabClick}>
                        <lightning-icon icon-name="utility:package" size="x-small"></lightning-icon>
                        Products
                    </button>
                    <button class={contactsTabClass} data-tab="contacts" onclick={handleTabClick}>
                        <lightning-icon icon-name="utility:people" size="x-small"></lightning-icon>
                        Contacts
                    </button>
                    <button class={adminTabClass} data-tab="admin" onclick={handleTabClick}>
                        <lightning-icon icon-name="utility:settings" size="x-small"></lightning-icon>
                        Admin
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <template lwc:if={isOverview}>
                        <!-- Overview: 3 cards in a row -->
                        <div class="overview-cards">
                            <c-nba-demo-account-details account-data={accountData}></c-nba-demo-account-details>
                            <c-nba-demo-payroll-status payroll-data={payrollStatusData}></c-nba-demo-payroll-status>
                            <c-nba-demo-quota-progress quota-data={quotaData}></c-nba-demo-quota-progress>
                        </div>
                        <c-nba-demo-sales-engagement engagement-data={engagementData}></c-nba-demo-sales-engagement>
                    </template>

                    <template lwc:if={isUpdates}>
                        <c-nba-demo-updates-tab record-id={effectiveRecordId}></c-nba-demo-updates-tab>
                    </template>

                    <template lwc:if={isPayroll}>
                        <c-nba-demo-payroll-tab payroll-tab-data={payrollTabData}></c-nba-demo-payroll-tab>
                    </template>

                    <template lwc:if={isProducts}>
                        <c-nba-demo-products-tab products-data={productsData} record-id={effectiveRecordId}></c-nba-demo-products-tab>
                    </template>

                    <template lwc:if={isContacts}>
                        <c-nba-demo-contacts-tab contacts-data={contactsData} oncontactemail={handleContactEmail} oncontactsms={handleContactSms}></c-nba-demo-contacts-tab>
                    </template>

                    <template lwc:if={isAdmin}>
                        <c-nba-demo-admin-tab admin-data={adminData}></c-nba-demo-admin-tab>
                    </template>
                </div>
            </div>

            <!-- Right Column: Sidebar -->
            <div class="workspace-sidebar">
                <c-nba-demo-sidebar
                    sidebar-data={sidebarData}
                    record-id={effectiveRecordId}
                    contacts={contactsData}
                    onnotesaved={handleNoteSaved}
                    onsmssent={handleSmsSent}>
                </c-nba-demo-sidebar>
            </div>
        </div>

        <!-- Action Bar (App Page mode only) -->
        <template lwc:if={showActionBar}>
            <c-nba-action-bar
                current-action={currentAction}
                is-transitioning={isTransitioning}
                oncomplete={handleCompleteAction}
                onsnooze={handleSnoozeAction}
                ondismiss={handleDismissAction}>
            </c-nba-action-bar>
        </template>

        <!-- Email Modal (conditional) -->
        <template lwc:if={showEmailModal}>
            <c-nba-demo-email-modal
                contacts={contactsData}
                record-id={effectiveRecordId}
                selected-contact={selectedEmailContact}
                onclose={handleEmailModalClose}
                onemailsent={handleEmailSent}>
            </c-nba-demo-email-modal>
        </template>

        <!-- SMS Modal (conditional) -->
        <template lwc:if={showSmsModal}>
            <c-nba-demo-sms-modal
                contacts={contactsData}
                record-id={effectiveRecordId}
                selected-contact={selectedSmsContact}
                onclose={handleSmsModalClose}
                onsmssent={handleSmsSent}>
            </c-nba-demo-sms-modal>
        </template>

        <!-- Snooze Dropdown (conditional, Record Page mode only) -->
        <template lwc:if={showSnoozeDropdown}>
            <c-nba-demo-snooze-dropdown onclose={handleSnoozeClose}></c-nba-demo-snooze-dropdown>
        </template>
    </template>
</template>
